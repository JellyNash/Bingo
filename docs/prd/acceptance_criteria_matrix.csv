User Story,ID,Given,When,Then,Perf Target,Notes
Player joins by PIN,US-PL-001,"Given an active game PIN and available slot","When the player submits PIN + unique nickname","Then the server validates credentials, issues signed card + JWT, or returns specific error","<200ms server p95","Errors include invalid PIN, game closed, name collision"
Player marks/undoes called number,US-PL-002,"Given number X appears on the card and has been drawn","When the player taps the cell","Then the cell toggles marked state with visual confirmation and server ack","<120ms round-trip, <16ms frame render","Server rejects undrawn numbers with toast"
Player claims Bingo (valid),US-PL-003,"Given the player has a complete winning pattern","When Claim Bingo is pressed","Then the server validates pattern, records winner, and broadcasts results","<300ms end-to-end","Sets game state to WON when single-winner"
Player claims Bingo (invalid),US-PL-004,"Given the pattern is incomplete","When Claim Bingo is pressed","Then the server denies claim, applies +1 strike, triggers 30s cooldown","<150ms denial response","Cooldown timer visible to player and GM"
Player resumes after reload,US-PL-005,"Given a valid resume token","When the player reloads within session window","Then the client restores board, replays missed draws, and resumes socket","Reconnect ≤3s on LAN","New token issued and resume_success logged"
GameMaster creates lobby,US-GM-000,"Given GM is authenticated","When GM configures settings and presses Create","Then system persists game, generates PIN, and opens lobby","<500ms API p95","Settings stored with HMAC checksum"
GameMaster start/pause/resume,US-GM-003,"Given lobby has ≥1 player","When GM presses Start, Pause, or Resume","Then game state updates and broadcasts to clients","<200ms propagation","Pause halts auto-draw timer without extra draw"
GameMaster draws number,US-GM-001,"Given game state=RUNNING and balls remain","When GM triggers manual draw","Then next number persists, LEDGER signs it, and clients update","<200ms publish→receive","History panel updates across all clients"
Auto-draw interval,US-GM-002,"Given auto-draw toggled on","When GM sets interval N (5–20s) and enables","Then numbers draw on schedule honoring pause/resume","±100ms jitter around target interval","Timer stops during GM media cues"
Manage claims & strikes,US-GM-004,"Given one or more pending claims","When GM accepts or denies a claim","Then winner state updates, strikes adjust, and notifications emit","<250ms resolution","Audit log includes GM ID and action"
Penalty disqualification,US-GM-005,"Given a player reaches 3 strikes","When threshold is met or GM enforces disqualification","Then claim button disables, banner displays reason, and GM can reinstate","UI update <150ms","Disqualified player excluded from winner prompts"
Big-Screen updates draws,US-SC-001,"Given a new draw event","When Big-Screen receives broadcast","Then current number animates, history shifts, and media cues sync","60fps animation with <50ms animation start delay","No dropped frames in 5-minute soak"
Offline discovery (LAN),US-NET-001,"Given GameMaster advertises bingo.local via mDNS","When Player app scans network","Then endpoint resolves and connects without manual IP","Discovery <2s on LAN","Fallback manual entry logged"
Server-authoritative validation,US-ARCH-001,"Given mark/claim payloads arrive","When server processes them","Then only signed, valid state persists and tampered payloads rejected","<100ms validation p95","WARN log + metric on rejection"
Rate limit claims,US-SEC-001,"Given a player exceeds 5 claims/min","When next claim is attempted","Then system blocks action, issues strike, and logs rate limit","Block response <120ms","Metric `claims_rate_limited` increments"
Observability baseline,US-OPS-001,"Given services are running","When join/draw/claim flows occur","Then traces, metrics, and logs appear in Grafana/OTel dashboards","Telemetry ingest <60s","Dashboard IDs documented in runbook"
PWA install & offline resume,US-PWA-001,"Given user meets install criteria","When PWA prompt fires","Then install prompt displays and service worker caches core assets","Precache <2s on reference device","Offline splash passes Lighthouse offline test"
Scale soak test,US-SCL-001,"Given load rig simulates 1000 concurrent players","When 15-minute soak runs","Then average draw latency stays <200ms, error rate <1%","Latency <200ms avg; error rate <1%","Report exported to Prometheus + shared drive"
Signed draw ledger integrity,US-AUD-001,"Given draws are persisted","When auditor reviews ledger","Then each entry has HMAC signature verifiable with shared secret","Verification <50ms per entry","Mismatch raises critical alert"
